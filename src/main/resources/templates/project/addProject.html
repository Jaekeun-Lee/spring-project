<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="/resources/css/additional.css">
    <title>프로젝트 등록하기</title>

</head>
<nav th:include="topToolBar.html"></nav>
<body style="background-color: #fff;">
<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="/smarteditor/js/service/HuskyEZCreator.js" charset="utf-8"></script>
<div class="container">
    <div class="row">

        <!-- left side bar -->
        <div class="container col-lg-2 col-md-12 ml-2 ">

            <div id="followquick" class="page-name col-xs-12">
                <h4 class="mb-3">ADD PROJECT FORM</h4>
                <div class="statusCheck">
                    <input type="text" id="input-check-1" value="기본 정보" class="form-control" disabled=""
                           style="border:none; background-color: #fff; margin-bottom: 5px;">
                </div>
                <div class="statusCheck">
                    <input type="text" id="input-check-2" value="프로젝트 분류" class="form-control" disabled=""
                           style="border:none; background-color: #fff; margin-bottom: 5px;">
                </div>
                <div class="statusCheck">
                    <input type="text" id="input-check-3" value="프로젝트 정보" class="form-control" disabled=""
                           style="border:none; background-color: #fff; margin-bottom: 5px;">
                </div>
                <div class="statusCheck">
                    <input type="text" id="input-check-4" value="추가 정보" class="form-control" disabled=""
                           style="border:none; background-color: #fff; margin-bottom: 5px;">
                </div>
                <div class="statusCheck">
                    <input type="text" id="input-check-5" value="모집 요건" class="form-control" disabled=""
                           style="border:none; background-color: #fff; margin-bottom: 5px;">
                </div>
            </div>

        </div>


        <!-- right form data -->
        <div class="container col-lg-9 col-md-12 mr-1 ml-1">
            <form id="addProjectForm" method="POST" th:action="@{/project/addProject}" enctype="multipart/form-data">
                <input type="hidden" name="leaderId" th:value="${session.user.userId}"/>


                <!-- 기본 정보 -->
                <div class="form-group row"><h4 class="col-lg-12 form-group-header">기본 정보</h4></div>
                <div class="field item form-group row">
                    <label class="col-form-label col-lg-4 col-md-4  label-align" style="text-align: left"><strong>프로젝트
                        제목</strong><span
                            class="required">*</span></label>
                    <div class="col-lg-8 col-md-8">
                        <input class="form-control" data-validate-length-range="6" data-validate-words="2"
                               data-parsley-minlength="15" data-parsley-maxlength="30" data-parsley-trigger="keyup"
                               data-parsley-validation-threshold="1"
                               name="projectName" placeholder="예) SpringBoot를 활용한 쇼핑몰 플랫폼 구축" autocomplete="off"
                               required="required">
                    </div>
                </div>

                <div class="field item form-group row">
                    <label class="col-form-label col-lg-4 col-md-4  label-align" style="text-align: left"><strong>예상
                        시작일</strong> <span
                            class="required">*</span></label>
                    <div class="col-lg-8 col-md-8">
                        <input id="preStartDate" name="preStartDate" class="date-picker form-control"
                               placeholder="yyyy-mm-dd" type="date" required="required" onfocus="this.type='date'"
                               onmouseover="this.type='date'" onclick="this.type='date'" onblur="this.type='text'">
                    </div>
                </div>

                <div class="form-group row">
                    <label class="control-label col-md-4 col-sm-4 " for="recruitmentMemberCnt"><strong>모집 인원 수</strong></label>
                    <div class="col-md-8 col-sm-8 ">
                        <select class="form-control" id="recruitmentMemberCnt" name="recruitmentMemberCnt">
                            <option value="1" selected>1 명</option>
                            <option value="2">2 명</option>
                            <option value="3">3 명</option>
                            <option value="4">4 명</option>
                            <option value="5">5 명</option>
                        </select>
                    </div>
                </div>


                <!-- 프로젝트 분류 -->
                <div class="form-group row"><h4 class="col-lg-12 form-group-header">프로젝트 분류</h4></div>
                <div class="form-group" style="display: block">
                    <label class="control-label"><strong>프로젝트 진행 분류</strong></label>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="customRadio1" name="progressClassification" class="custom-control-input"
                               value="1" checked>
                        <label class="custom-control-label" for="customRadio1">신규프로젝트를 진행하려고 합니다.</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="customRadio2" name="progressClassification" class="custom-control-input"
                               value="2">
                        <label class="custom-control-label" for="customRadio2">기존프로젝트 유지보수를 하려고 합니다.</label>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-md-4"><strong>프로젝트 카테고리</strong></label>
                    <div class="btn-group btn-group-toggle col-md-8" data-toggle="buttons">
                        <label class="btn btn-outline-primary active" style="margin-right: 5px">
                            <input type="radio" name="projectCategory" id="projectCategory1" value="1" checked=""> 개발
                        </label>
                        <label class="btn btn-outline-primary" style="margin-right: 5px">
                            <input type="radio" name="projectCategory" id="projectCategory2" value="2"> 기획
                        </label>
                        <label class="btn btn-outline-primary">
                            <input type="radio" name="projectCategory" id="projectCategory3" value="3"> 디자인
                        </label>
                    </div>
                </div>

                <div class="field item form-group row">
                    <label class="col-form-label col-lg-4 col-md-4 label-align" style="text-align: left">예상진행기간<span
                            class="required">*</span></label>
                    <div class="col-lg-8 col-md-8">
                        <div class="input-group mb-3">
                            <input type="text" id="prePeriod" name="prePeriod" class="form-control"
                                   placeholder="ex) 100" required>
                            <div class="input-group-append">
                                <span class="input-group-text">일</span>
                            </div>
                        </div>
                    </div>
                </div>


                <!--

                                &lt;!&ndash; 프로젝트 정보 &ndash;&gt;
                                <div class="form-group row"><h4 class="col-lg-12 form-group-header">프로젝트 정보</h4></div>
                                <div class="x_panel col-md-12 col-sm-12" style="margin: 100px 0; width: 100%">
                                    <div class="x_title">
                                        <label>프로젝트 상세정보</label>
                                        <ul class="nav navbar-right panel_toolbox">
                                            <li>
                                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="x_content">
                                        <div class="btn-toolbar editor" data-role="editor-toolbar" data-target="#editor-one">
                                            <div class="btn-group">
                                                <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font"><i
                                                        class="fa fa-font"></i><b class="caret"></b></a>
                                                <ul class="dropdown-menu">
                                                </ul>
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font Size"><i
                                                        class="fa fa-text-height"></i>&nbsp;<b class="caret"></b></a>
                                                <ul class="dropdown-menu">
                                                    <li>
                                                        <a data-edit="fontSize 5">
                                                            <p style="font-size:17px">Huge</p>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a data-edit="fontSize 3">
                                                            <p style="font-size:14px">Normal</p>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a data-edit="fontSize 1">
                                                            <p style="font-size:11px">Small</p>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn" data-edit="bold" title="Bold (Ctrl/Cmd+B)"><i class="fa fa-bold"></i></a>
                                                <a class="btn" data-edit="italic" title="Italic (Ctrl/Cmd+I)"><i
                                                        class="fa fa-italic"></i></a>
                                                <a class="btn" data-edit="strikethrough" title="Strikethrough"><i
                                                        class="fa fa-strikethrough"></i></a>
                                                <a class="btn" data-edit="underline" title="Underline (Ctrl/Cmd+U)"><i
                                                        class="fa fa-underline"></i></a>
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn" data-edit="insertunorderedlist" title="Bullet list"><i
                                                        class="fa fa-list-ul"></i></a>
                                                <a class="btn" data-edit="insertorderedlist" title="Number list"><i
                                                        class="fa fa-list-ol"></i></a>
                                                <a class="btn" data-edit="outdent" title="Reduce indent (Shift+Tab)"><i
                                                        class="fa fa-dedent"></i></a>
                                                <a class="btn" data-edit="indent" title="Indent (Tab)"><i class="fa fa-indent"></i></a>
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn btn-info" data-edit="justifyleft" title="Align Left (Ctrl/Cmd+L)"><i
                                                        class="fa fa-align-left"></i></a>
                                                <a class="btn" data-edit="justifycenter" title="Center (Ctrl/Cmd+E)"><i
                                                        class="fa fa-align-center"></i></a>
                                                <a class="btn" data-edit="justifyright" title="Align Right (Ctrl/Cmd+R)"><i
                                                        class="fa fa-align-right"></i></a>
                                                <a class="btn" data-edit="justifyfull" title="Justify (Ctrl/Cmd+J)"><i
                                                        class="fa fa-align-justify"></i></a>
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn dropdown-toggle" data-toggle="dropdown" title="Hyperlink"><i
                                                        class="fa fa-link"></i></a>
                                                <div class="dropdown-menu input-append">
                                                    <input class="span2" placeholder="URL" type="text" data-edit="createLink">
                                                    <button class="btn" type="button">Add</button>
                                                </div>
                                                <a class="btn" data-edit="unlink" title="Remove Hyperlink"><i class="fa fa-cut"></i></a>
                                            </div>
                                            <div class="btn-group">
                                                <label class="custom-file-label" id="file-label" for="file-upload">IMAGE UPLOAD</label>
                                                <input type="file" name="files" id="file-upload" multiple="multiple">
                                            </div>
                                            <div class="btn-group">
                                                <a class="btn" data-edit="undo" title="Undo (Ctrl/Cmd+Z)"><i class="fa fa-undo"></i></a>
                                                <a class="btn" data-edit="redo" title="Redo (Ctrl/Cmd+Y)"><i
                                                        class="fa fa-repeat"></i></a>
                                            </div>
                                        </div>


                                        <div id="editor-one" name="projectDetail" class="editor-wrapper"></div>

                                        <textarea name="projectDetail" id="projectDetail" style="display:none;"></textarea>
                                        <br/>
                                        <b id="fileEA">0</b><span>개의 문서 파일 선택</span>
                                        <div class="ln_solid"></div>
                                        <div id="elseFile"></div>
                                    </div>
                                </div>-->

                <!-- 프로젝트 상세내용 -->
                <!-- SmartEditor2 -->
                <div class="form-group row">
                    <div class="col-md-12">
                        <div class="btn-group">
                            <label class="custom-file-label" id="file-label" for="file-upload">IMAGE UPLOAD</label>
                            <input type="file" name="files" id="file-upload" multiple="multiple">
                        </div>
                        <textarea name="projectDetail" id="projectDetail" style="width:100%;min-width:260px; height: 300px; "></textarea>

                        <br/>
                        <b id="fileEA">0</b><span>개의 문서 파일 선택</span>
                        <div class="ln_solid"></div>
                        <div id="elseFile"></div>
                    </div>
                </div>

                <!-- 추가 정보 -->
                <div class="form-group row"><h4 class="col-lg-12 form-group-header">추가 정보</h4></div>
                <div class="form-group control-group row">
                    <label class="control-label col-md-4 col-sm-4 ">Skill Tags</label>
                    <div class="col-md-8 col-sm-8 ">
                        <input id="tags_1" type="text" class="tags form-control" value=""/>
                        <div id="suggestions-container"
                             style="position: relative; float: left; width: 250px; margin: 10px;">
                            <input type="hidden" id="skillHashTag" name="skillHashTag">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label">미팅 방식</label>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="meetingMethod1" name="meetingMethod" class="custom-control-input"
                               value="1"
                               checked="">
                        <label class="custom-control-label" for="meetingMethod1">온라인 미팅 ( 카카오톡 , 화상채팅 등)</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="meetingMethod2" name="meetingMethod" class="custom-control-input"
                               value="2">
                        <label class="custom-control-label" for="meetingMethod2">오프라인 미팅</label>
                    </div>
                </div>


                <div class="form-group">
                    <label for="meetingLocation1">미팅 위치</label>
                    <select class="form-control" id="meetingLocation1" name="meetingLocation">
                        <option value="선택안함" selected> 시 / 도</option>
                        <option value="서울특별시">서울특별시</option>
                        <option value="부산광역시">부산광역시</option>
                        <option value="대구광역시">대구광역시</option>
                        <option value="인천광역시">인천광역시</option>
                        <option value="광주광역시">광주광역시</option>
                        <option value="대전광역시">대전광역시</option>
                        <option value="울산광역시">울산광역시</option>
                        <option value="세종특별자치시">세종특별자치시</option>
                        <option value="경기도">경기도</option>
                        <option value="강원도">강원도</option>
                        <option value="충청북도">충청북도</option>
                        <option value="충청남도">충청남도</option>
                        <option value="전라북도">전라북도</option>
                        <option value="전라남도">전라남도</option>
                        <option value="경상북도">경상북도</option>
                        <option value="경상남도">경상남도</option>
                        <option value="제주특별자치도">제주특별자치도</option>
                        <option value="해외">해외</option>
                    </select>
                </div>


                <div class="form-group row"><h4 class="col-lg-12 form-group-header">모집 요건</h4></div>
                <div class="field item form-group row">
                    <label class="col-form-label col-lg-4 col-md-4  label-align" style="text-align: left">신청서 제출 마감일
                        <span class="required">*</span></label>
                    <div class="col-lg-8 col-md-8">
                        <input id="applicationDeadline" name="applicationDeadline" class="date-picker form-control"
                               placeholder="yyyy-mm-dd" type="date" required="required" onfocus="this.type='date'"
                               onmouseover="this.type='date'" onclick="this.type='date'" onblur="this.type='text'">
                    </div>
                </div>

                <div class="form-group" id="question-group">
                    <label class="control-label">신청자 지원 전 질문사항 등록<br/><small>(최대 3개 까지 등록가능)</small></label>
                    <div class="applicantQuestion">
                        <input type="text" name="applicantQuestionA" class="form-control col-lg-10 col-md-10"
                               placeholder="예) 스프링부트 관련 프로젝트를 진행해본적이 있나요?"/>
                        <div class="col-lg-2 col-md-2 add-question-btn" onclick="javascript:addQuestion(this)">
                            <span class="glyphicon glyphicon-plus"
                                  style="margin-top: 10px;margin-bottom: 10px;font-size: 19px;"></span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <input type="submit" id="addProject-btn" class="btn btn-outline-primary col-12" value="등록완료"/>
                </div>
            </form>


        </div>

    </div>
</div>


</body>



<script>
    var oEditors = [];
    nhn.husky.EZCreator.createInIFrame({
        oAppRef: oEditors, elPlaceHolder: "projectDetail", //저는 textarea의 id와 똑같이 적어줬습니다.
        sSkinURI: "/smarteditor/SmartEditor2Skin.html", //경로를 꼭 맞춰주세요!
        bSkipXssFilter : true,
        fCreator: "createSEditor2",
        // htParams: { // 툴바 사용 여부 (true:사용/ false:사용하지 않음)
        //     bUseToolbar: true, // 입력창 크기 조절바 사용 여부 (true:사용/ false:사용하지 않음)
        //     bUseVerticalResizer: false, // 모드 탭(Editor | HTML | TEXT) 사용 여부 (true:사용/ false:사용하지 않음)
        //     bUseModeChanger: false
        // }
    });


</script>

<script>
    // 등록 전 유효성 검사 필수항목
    let validator = new FormValidator({"events": ['blur', 'input', 'change']}, document.forms[0]);
    // on form "submit" event
    document.forms[0].onsubmit = function (e) {

        let submit = true,
            validatorResult = validator.checkAll(this);
        return !!validatorResult.valid;
    };

    // 날짜 선택 ( 최소날짜 오늘로 설정 )
    let today = new Date().toISOString().substring(0, 10);
    $("#preStartDate").attr('min', today);
    $("#applicationDeadline").attr('min', today);

    $('#addProject-btn').on('click', function () {
        // let projectDetail = $('#editor-one').html();
        // $('#projectDetail').val(projectDetail);
        // alert($('#projectDetail').val());
        oEditors.getById["projectDetail"].exec("UPDATE_CONTENTS_FIELD", []);

        $('#skillHashTag').val($('.tag span').text());

        $('#addProjectForm').submit();
    })

    // 신청자 질문사항 추가
    function addQuestion(elem) {
        let questionCount = $('div[class=applicantQuestion]').length;
        alert("addQuestion" + questionCount)
        let html = `<div class="applicantQuestion">
                        <input type="text" class="form-control col-lg-10 col-md-10"/>
                        <div class="col-lg-1 col-md-1 delete-question-btn" onclick="javascript:deleteQuestion(this)">
                            <span class="glyphicon glyphicon-remove-circle" style="margin-top: 10px;margin-bottom: 10px;font-size: 19px;"></span>
                        </div>`
        if (questionCount < 2) {
            html += `<div class="col-lg-1 col-md-1 add-question-btn" onclick="javascript:addQuestion(this)">
                            <span class="glyphicon glyphicon-plus" style="margin-top: 10px;margin-bottom: 10px;font-size: 19px;"></span>
                        </div>
                    </div>`
        } else {
            html += `
                    </div>`
        }


        $(elem).children().attr('class', 'glyphicon glyphicon-remove-circle');
        $(elem).attr('onclick', 'javascript:deleteQuestion(this)');
        if (questionCount == 1) {
            $(elem).attr('class', 'col-lg-1 col-md-1 delete-question-btn');
        }
        $("#question-group div[class=applicantQuestion]").each(function (i, element) {
            $(element).children('div[class*=add-question-btn]').css('display', 'none')
        });


        $('#question-group').append(html);

        indexReset()

    }

    function deleteQuestion(elem) {
        const target = $(elem).parent();

        target.remove();

        let questionCount = $('div[class=applicantQuestion]').length;
        alert("deleteQuestion" + questionCount)
        if (questionCount == 2) {
            $('div[class=applicantQuestion]').children('div[class*=add-question-btn]').css('display', 'block');
            $('div[class=applicantQuestion]').children('div[class*=add-question-btn]').attr('onclick', 'javascript:addQuestion(this)');
            $('div[class=applicantQuestion]').children('div[class*=add-question-btn]').children().attr('class', 'glyphicon glyphicon-plus');
        } else if (questionCount == 1) {
            $('div[class=applicantQuestion]').children('div[class*=add-question-btn]').css('display', 'block');
            $('div[class=applicantQuestion]').children('div[class*=question-btn]').attr('onclick', 'javascript:addQuestion(this)');
            $('div[class=applicantQuestion]').children('div[class*=question-btn]').children().attr('class', 'glyphicon glyphicon-plus');
        }

        indexReset()
    }

    function indexReset() {
        let toIndex = ['A', 'B', 'C'];
        $("#question-group div[class=applicantQuestion]").each(function (i, element) {
            let toName = 'applicantQuestion' + toIndex[i]
            $(element).children('input[type=text]').attr('name', toName)
            $(element).children('input[type=text]').attr('placeholder', toName)
        });

    }


    let sel_files = [];

    $("#file-upload").on("change", function handleImgsFilesSelect(e) {
        let files = e.target.files;
        let filesArr = Array.prototype.slice.call(files);

        $("#elseFile").empty();
        for (let i = 0; i < files.length; i++) {
            if (!checkExtension(files[i].name, files[i].size)) {
                return false;
            }
        }
        $('#file-label').text(files.length + "개 파일 선택")
        $('#fileEA').text('0')

        filesArr.forEach(function (f) {

            if (f.type.match("image.*")) {
                sel_files.push(f);

                let reader = new FileReader();
                reader.onload = function (e) {
                    let img_html = "<img src=\"" + e.target.result + "\" />";
                    oEditors.getById["projectDetail"].exec("PASTE_HTML", [img_html]);
                    // $("#iii").append(img_html);
                }
                reader.readAsDataURL(f);
            } else {
                let fileName = f.name;
                $('#fileEA').text(files.length);
                $("#elseFile").append(fileName);

            }

        });
    });

    function checkExtension(fileName, fileSize) {

        let regex = new RegExp("(.*?)\.(exe|sh|zip|alz)$");
        let maxSize = 41943040;  //40MB

        if (fileSize >= maxSize) {
            alert('파일 사이즈 초과');
            $("input[type='file']").val("");  //파일 초기화
            return false;
        }

        if (regex.test(fileName)) {
            alert('업로드 불가능한 파일이 있습니다.');
            $("input[type='file']").val("");  //파일 초기화
            return false;
        }
        return true;
    }


    $('#followquick').animate({'top': $(document).scrollTop() + 100 + 'px'});
    //follow quick menu
    $(window).scroll(function () {
        $("#followquick").stop();
        $('#followquick').animate({'top': $(document).scrollTop() + 100 + 'px'}, 700);

    });

    $('form').change(function () {

        if ($('#input-check-1').attr('class') == 'form-control') {
            if ($('input[name=projectName]').val() != '' && $('#preStartDate').val() != '') {
                $('#input-check-1').addClass('is-valid')
                $('#input-check-1').fadeOut();
                $('#input-check-1').fadeIn();
            }
        }

        if ($('#input-check-2').attr('class') == 'form-control') {
            if ($('#prePeriod').val() != '') {
                $('#input-check-2').addClass('is-valid')
                $('#input-check-2').fadeOut();
                $('#input-check-2').fadeIn();
            }
        }


        if ($('#input-check-3').attr('class') == 'form-control') {
            if ($('#editor-one').text() != '') {
                $('#input-check-3').addClass('is-valid')
                $('#input-check-3').fadeOut();
                $('#input-check-3').fadeIn();
            }
        }

        if ($('#input-check-4').attr('class') == 'form-control') {
            if ($('.tag').text() != '') {
                $('#input-check-4').addClass('is-valid')
                $('#input-check-4').fadeOut();
                $('#input-check-4').fadeIn();
            }
        }

        if ($('#input-check-5').attr('class') == 'form-control') {
            if ($('#applicationDeadline').val() != '') {
                $('#input-check-5').addClass('is-valid')
                $('#input-check-5').fadeOut();
                $('#input-check-5').fadeIn();
            }
        }
    })

</script>
</html>
