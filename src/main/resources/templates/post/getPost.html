<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="/js/bpopup/jquery.bpopup.min.js"></script>

    <script type="text/javascript">

        // function del(postNo){
        //     let chk = confirm("정말 삭제하시겠습니까?");
        //     if (chk){
        //         // location.href='/comm/delete?postNo='+(postVO.postNo);
        //         location.href="deletePost?postNo=(postNo)";
        //     }
        // }
        /*---------------------------------------------------*/
        // let formObj = $("form[role='form']");
        //
        // $("#delete_btn").click(function (){
        //
        //     formObj.attr("action", "/comm/deletePost");
        //     formObj.attr("method", "get");
        //     formObj.submit();
        // })
        /*---------------------------------------------------*/






        $(function () {
            $('#add-reply-btn').on('click', function () {
                $.ajax({
                    type: 'POST',
                    url: '/comm/addReply',
                    data: JSON.stringify({
                        postNo: $('#postNo').val(),
                        replyContent: $('#replyContent').val()
                    }),//서버로 보낼 데이터를지정해주는
                    dataType: 'text',//받아올때 서버에서
                    contentType: 'application/json',//서버에 데이터를 보낼때
                    success: function (data) {
                        alert("댓글 등록 완료");
                        const replyVO = JSON.parse(data);
                        const regDate = replyVO.regDate.substring(0, 10);

                        let html =
                            "<div class=\"card bg-secondary mb-3\" style=\"max-width: 20rem;\">" +
                            "   <div class=\"card-header\">" + replyVO.replyUserId + "</div>" +
                            "       <div class=\"card-body\">" +
                            "           <h4 class=\"card-title\">" + replyVO.replyContent + "</h4>" +
                            "       <p class=\"card-text\">" + regDate + "</p>" +
                            "   </div>" +
                            "</div>"

                        $('#reply-list').append(html);
                        $('#replyContent').val("");
                    },
                    error: function (e) {
                        alert("댓글 등록 실패" + e)
                    }
                })

            })


            $('#delete-reply-btn').on('click', function () {
                if (confirm("댓글을 삭제 하시겠습니까?")) {

                    $.ajax({
                        type: 'POST',
                        url: '/comm/deleteReply',
                        async : "true",
                        data: JSON.stringify({
                            postNo: $('#postNo').val(),
                            replyNo: $('#replyNo').val()
                        }),
                        dataType: 'text',
                        contentType: 'application/json',
                        success: function (data) {
                            console.log(1);
                            alert("댓글 삭제 완료");
                            // console.log(6);
                            // const replyVO = JSON.parse(data);
                            // console.log(7);
                            // const regDate = replyVO.regDate.substring(0, 10);
                            // console.log(8);

                        },
                        error: function (e) {
                            alert("댓글 삭제 실패" + e)
                        }
                    })
                }
            })
        })



    </script>


<title>게시물 상세조회</title>
</head>
<body>
<form>
<!--<form th:action="@{/post/getPost}" th:method="get">-->
    <input type="hidden"    name="postNo"   id="postNo"   th:value="${postVO.postNo}">
<!--    <div th:text="${postVO.postNo}">번호</div>-->
    <div th:text="${postVO.postName}">제목</div>
    <div th:text="${postVO.userId}">작성자</div>
    <div th:text="${#dates.format(postVO.regDate, 'yyyy-MM-dd')}">작성날짜</div>
<!--    <div th:text="${postVO.postContent}">내용</div>-->
    <textarea cols="120" rows="30" name="postContent"  th:text="${postVO.postContent}" readonly>내용</textarea><br>

    <div style="float: left;">
        <a th:href="@{/comm/getPostList}">목록</a>
        <a th:href="@{/comm/updatePost(postNo=${postVO.postNo})}">수정</a>
        <a th:href="@{/comm/deletePost(postNo=${postVO.postNo})}">삭제</a>
<!--        <input type="button"  value="삭제"  onclick="del(postNo)">-->
<!--        <p>-->
<!--            <button id="delete_btn" onclick="location.href='deletePost?postNo=${postNo}'">삭제</button>-->
<!--        </p>-->
    </div>
</form>
<!--에이작스 포스트방식으로 댓글 리퀘스트-->
<form>
<!--    <input type="hidden"    name="replyNo"  id="replyNo"    th:value="${replyVO.replyNo}">-->
    <div class="reply-box">
        <h5 id="reply-list">댓글</h5>
        <div th:each="replyVO:${postVO.postReply}" class="card-secondary mb-3"    style="...">
            <div th:text="${replyVO.replyUserId}"   class="card-header"></div>
            <div class="card-body">
                <h4 th:text="${replyVO.replyContent}"   class="card-title"></h4>
                <p th:text="${#dates.format(replyVO.regDate, 'yyyy-MM-dd')}"    class="card-text"></p>
                <button type="button"   id="update-reply-btn"   class="btn btn-warning">수정</button>
                <button type="button"   id='delete-reply-btn' class="btn btn-danger">삭제</button>
            </div>
        </div>

        <div class="form-group">
            <div class="card-header">댓글다는사람의 로그이정보 띄워줘야함</div>
            <input class="form-control"   id="replyContent"   rows="3"    style="..."></input>
            <div class="card-header"    style="...">
                <button type="button"   id="add-reply-btn"  class="btn btn-primary">작성</button>
            </div>
        </div>

    </div>
</form>
</body>

</html>