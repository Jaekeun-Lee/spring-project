<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper 
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
		
<mapper namespace="projectMapper">

	<resultMap id="projectSelectMap" type="com.example.demo.project.vo.ProjectVO">
		<result property="projectNo"	    		column="project_no"         		jdbcType="NUMERIC"/>
		<result property="leaderId"    				column="user_id"      				jdbcType="VARCHAR"/>
		<result property="projectName" 				column="project_name"      			jdbcType="VARCHAR"/>
		<result property="progressClassification"   column="progress_Classification"    jdbcType="NUMERIC"/>
		<result property="projectCategory"    		column="project_category"      		jdbcType="NUMERIC"/>
		<result property="preStartDate"    			column="pre_start_date"      		jdbcType="DATE"/>
		<result property="prePeriod"    			column="pre_period"      			jdbcType="NUMERIC"/>
		<result property="regDate"    				column="reg_date"      				jdbcType="DATE"/>
		<result property="applicationDeadline"    	column="application_deadline"      	jdbcType="DATE"/>
		<result property="meetingMethod"    		column="meeting_method"      		jdbcType="NUMERIC"/>
		<result property="meetingLocation"    		column="meeting_location"      		jdbcType="VARCHAR"/>
		<result property="applicantQuestionA"    	column="applicant_question_a"      	jdbcType="VARCHAR"/>
		<result property="applicantQuestionB"    	column="applicant_question_b"      	jdbcType="VARCHAR"/>
		<result property="applicantQuestionC"    	column="applicant_question_c"      	jdbcType="VARCHAR"/>
		<result property="projectViewCnt"    		column="project_view_cnt"      		jdbcType="NUMERIC"/>
		<result property="projectStatus"    		column="project_status"      		jdbcType="NUMERIC"/>
		<result property="endProjectCnt"    		column="endProject_cnt"   			jdbcType="NUMERIC"/>
		<result property="projectDetail"    		column="project_detail"      		jdbcType="VARCHAR"/>
		<result property="endDate"    				column="end_date"      				jdbcType="DATE"/>
		<result property="recruitmentMemberCnt"    	column="recruitmentmembercnt"      	jdbcType="NUMERIC"/>
		
		<!-- association -->
		<association property="applicantsCnt"	column="project_no"		select="getApplicantsCnt"/>

<!--		<association property="recruitmentMemberCnt" 	javaType="int">-->
<!--			<result property="recruitmentMemberCnt" 	column="count" jdbcType="NUMERIC"/>-->
<!--		</association>-->

		<!-- collection -->
		<collection property="teamMember" 	column="project_no" javaType="java.util.ArrayList" ofType="com.example.demo.member.vo.MemberVO" select="getProjectMemberByProjectNo"/>
		<collection property="skillHashTag" column="project_no" javaType="java.util.ArrayList" ofType="java.lang.String" select="getProjectHashTagByProjectNo"/>
		<collection property="projectReply" column="project_no" select="getProjectReplyByProjectNo"/>

	</resultMap>

	<select id="getApplicantsCnt" resultType="int">
		SELECT count(*)
		FROM APPLICANT
		WHERE project_no = #{project_no}
	</select>

	<select id = "getProjectMemberByProjectNo" resultType="com.example.demo.member.vo.MemberVO">
		SELECT user_id as userId, profile_image
		FROM MEMBER
		WHERE PROJECT_NO = #{projectNo}
	</select>

	<select id = "getProjectHashTagByProjectNo" resultType="java.lang.String">
		SELECT hashtag
		FROM skill_hashtag sh, hashtag h
		WHERE sh.hashtag_no = h.hashtag_no AND sh.project_no = #{project_no}
	</select>

	<select id = "getProjectReplyByProjectNo" resultType="com.example.demo.community.vo.ReplyVO">
		SELECT reply_no as replyNo, user_id as replyUserId, reply_content as replyContent, reg_date as replyRegDate
		FROM REPLY
		WHERE PROJECT_NO = #{projectNo}
	</select>
	
	<select  id="getProject"  parameterType="int"	 resultMap="projectSelectMap">
	  	SELECT *
	  	FROM project
	  	WHERE project_no = #{projectNo}
	 </select>
	 
	 <insert id="addProject" parameterType="projectVO">
		INSERT 
		INTO PROJECT (
			PROJECT_NO, 
			USER_ID, 
			PROJECT_NAME, 
			PROGRESS_CLASSIFICATION, 
			PROJECT_CATEGORY, 
			PRE_START_DATE, 
			PRE_PERIOD, 
			MEETING_METHOD, 
			MEETING_LOCATION, 
			APPLICATION_DEADLINE, 
			PROJECT_DETAIL, 
			REG_DATE,  
			APPLICANT_QUESTION_A, 
			APPLICANT_QUESTION_B, 
			APPLICANT_QUESTION_C,
			RECRUITMENTMEMBERCNT
			)  
		VALUES(
			#{projectNo},
			#{leaderId},
			#{projectName},
			#{progressClassification},
			#{projectCategory},
			#{preStartDate},
			#{prePeriod},
			#{meetingMethod},
			#{meetingLocation},
			#{applicationDeadline},
			#{projectDetail},
			#{regDate},
			#{applicantQuestionA},
			#{applicantQuestionB},
			#{applicantQuestionC},
			#{recruitmentMemberCnt}
			)
	 </insert>

</mapper>