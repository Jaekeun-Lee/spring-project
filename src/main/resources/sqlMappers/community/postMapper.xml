<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="postMapper">
<!--    <sql id="postColumns">-->
<!--        -->
<!--    </sql>-->
    <resultMap id="postSelectMap" type="com.example.demo.community.vo.PostVO">
        <result property="postNo" column="post_no"  jdbcType="NUMERIC"/>
        <result property="postName"     column="post_name"      jdbcType="VARCHAR"/>
        <result property="postContent"      column="post_content"       jdbcType="VARCHAR"/>
        <result property="userId"       column="user_id"        jdbcType="VARCHAR"/>
        <result property="regDate"      column="reg_date"       jdbcType="DATE"/>
        <result property="replyCnt"     column="reply_cnt"      jdbcType="NUMERIC"/>
<!--        <result property=""-->
        <result property="viewCnt"      column="view_cnt"       jdbcType="NUMERIC"/>


    <collection property="postReply" column="post_no" select="getPostReplyByPostNo"/>

    </resultMap>

    <insert id="addPost" parameterType="com.example.demo.community.vo.PostVO">
        insert
        into POST(post_no,
                  post_name,
                  post_content,
                  user_Id,
                  reg_date,
                  reply_Cnt,
                  view_Cnt
--                   reply추가
                  )
        values (#{postNo},
                #{postName},
                #{postContent},
                #{userId},
                #{regDate},
                #{replyCnt},
                #{viewCnt})
    </insert>

    <select id="getPost"    parameterType="int"     resultMap="postSelectMap">
        SELECT POST_NO,
                POST_NAME,
                POST_CONTENT,
                USER_ID,
                REG_DATE,
                VIEW_CNT,
                REPLY_CNT

        FROM POST
        WHERE POST_NO = #{postNo}
    </select>

    <update id="updatePost"     parameterType="com.example.demo.community.vo.PostVO">
        UPDATE POST
        <set>
            POST_NAME = #{postName},
            POST_CONTENT = #{postContent},
            REG_DATE = #{regDate}

        </set>
        WHERE POST_No = #{postNo}
    </update>

    <delete id="deletePost"     parameterType="postVO">
        DELETE

        FROM POST

        WHERE POST_NO = #{postNo}

    </delete>

<!--    <select id="getPostList"    parameterType="postVO"  resultMap="postSelectMap">-->
<!--        SELECT *-->
<!--        FROM (SELECT inner_table.*, ROWNUM as row_seq-->
<!--            FROM(SELECT POST_NO as 번호,-->
<!--                        POST_NAME as 제목,-->
<!--                        USER_ID as 작성자,-->
<!--                        REG_DATE as 작성날짜,-->
<!--                        REPLY_CNT as 댓글수,-->
<!--                        VIEW_CNT as 조회수-->
<!--                 FROM POST-->
<!--                 WHERE USER_ID = #{userId}-->
<!--                 ORDER BY POST_NO )inner_table-->
<!--            WHERE ROWNUM <=#{endRowNum} )-->
<!--        WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}-->


<!--    </select>-->
    <select id="getPostList"    parameterType="postVO"      resultMap="postSelectMap">
        SELECT
                POST_NO,
                POST_NAME,
                USER_ID,
                REG_DATE,
                REPLY_CNT,
                VIEW_CNT
        FROM POST
    </select>




    <select id="getPostReplyByPostNo"   resultType="replyVO">
        select REPLY_NO as replyno,
               USER_ID as replyuserid,
               REPLY_CONTENT as replycontent,
               REG_DATE as reg_date
        FROM REPLY
        WHERE POST_NO = #{postNo}
    </select>

    <select id="getTotalCount"  parameterType="searchVO"    resultType="int">
        SELECT COUNT(*)
        FROM POST
    </select>


</mapper>